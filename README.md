# Image Moderation App

A FastAPI + MongoDB + AWS Rekognition app for image moderation with separate **Admin** and **User** roles, plus simple HTML/JS frontends.

## **Features**

- **Image Moderation**: Uses AWS Rekognition to detect unsafe content.
- **Role-based JWT**:

  - **Admin**: Can log in, create/delete/list tokens.
  - **User**: Can moderate images with a valid token.

- **Frontend UI**:

  - `/ui/admin.html` — Admin console
  - `/ui/user.html` — User console

- **Usage Logging**: Tracks API calls per token in MongoDB.

## **Requirements**

- [Docker](https://docs.docker.com/get-docker/)
- AWS account with Rekognition enabled
- AWS credentials (`AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`)
- MongoDB (provided via Docker Compose)

## **Setup & Run**

1. **Create `.env` in project root** (same folder as `docker-compose.yml`):
  env
  AWS_ACCESS_KEY_ID=your_access_key
  AWS_SECRET_ACCESS_KEY=your_secret_key
  AWS_DEFAULT_REGION=us-east-1
  JWT_SECRET=your_jwt_secret
  ADMIN_USER=admin
  ADMIN_PASS=admin123

2. **Start with Docker Compose**:

  docker-compose up --build

3. App runs at:

  Backend API: http://localhost:7000
  Admin UI: http://localhost:7000/ui/admin.html
  User UI: http://localhost:7000/ui/user.html

## **Usage Flow**

### **Admin**

1. Visit `/ui/admin.html`
2. Log in with `ADMIN_USER` / `ADMIN_PASS`
3. Create:
   - **User Token** → for image moderation
   - **Admin Token** → for managing tokens
4. Copy and share the **User Token** with users.

### **User**

1. Visit `/ui/user.html`
2. Paste the **User Token** from admin
3. Upload an image → click **Moderate**
4. Get result:

  - `"safe"` → no moderation labels detected
  - `"unsafe"` → labels + confidence scores

## **JWT Role Separation**

- **Admin JWT**:

  - Generated on login
  - Has `isAdmin: true`
  - Can call `/auth/tokens` endpoints

- **User JWT**:

  - Generated by admin
  - Has `isAdmin: false`
  - Can only call `/moderate`

JWTs are stored in MongoDB with role info, so expired/invalid tokens are rejected.

## **Stop Containers**

docker-compose down --remove-orphans
